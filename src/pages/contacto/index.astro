---
import Layout from "@/layouts/Layout.astro";
import { Image } from "astro:assets";

import { contactPage } from "@/services/contact";

const formFields = {
  name: "name",
  email: "email",
  phoneNumber: "number",
  company: "company",
  message: "message",
};

const { titulo, subtitulo, direccion, correo, telefono } = contactPage;
---

<Layout title=`${"Contacto"} | D2B` description={"Págica de contacto"}>
  <main>
    <section class="px-6 bg-top bg-cover bg-hero">
      <div class="m-auto max-w-screen-xl pb-24 pt-52">
        <h1
          class="text-white text-5xl font-bold max-w-[30ch] mb-6 animate-fade-left"
        >
          {titulo}
        </h1>
        <p
          class="text-white text-2xl w-1/2 max-w-[45ch] mb-14 animate-fade-left"
        >
          {subtitulo}
        </p>
      </div>
    </section>

    <section class="px-6 min-h-[500px]">
      <div
        class="py-8 md:py-20 m-auto flex flex-col-reverse md:grid max-w-screen-xl md:grid-cols-2 gap-8"
      >
        <div>
          <ul class="[&>li]:mb-6 [&>li]:flex [&>li]:gap-4">
            <li>
              <Image
                class="size-10 p-2 object-contain bg-accent-purple rounded-lg"
                src="/map-marker.webp"
                width={24}
                height={24}
                alt="map marker icon"
              />

              <div>
                <header class="text-2xl font-semibold">Dirección</header>
                <footer class="flex flex-col" set:html={direccion} />
              </div>
            </li>

            <li>
              <Image
                class="size-10 p-2 object-contain bg-accent-purple rounded-lg"
                src="/letter.webp"
                width={24}
                height={24}
                alt="mail icon"
              />

              <div>
                <header class="text-2xl font-semibold">
                  Correo electrónico
                </header>
                <footer>{correo}</footer>
              </div>
            </li>

            <li>
              <Image
                class="size-10 p-2 object-contain bg-accent-purple rounded-lg"
                src="/phone.webp"
                width={24}
                height={24}
                alt="phone icon"
              />

              <div>
                <header class="text-2xl font-semibold">Teléfono</header>
                <footer>{telefono}</footer>
              </div>
            </li>
          </ul>
        </div>

        <div class="relative">
          <form
            class="md:absolute w-full -top-[430px] bg-white p-0 md:p-12 border-b-2 md:border-2 border-neutral-200 md:rounded-2xl"
          >
            <label
              class="mb-1 block text-primary font-bold"
              for={formFields.name}
              >Nombre completo
            </label>
            <input
              type="text"
              id={formFields.name}
              name={formFields.name}
              class="w-full p-2 mb-6 border rounded-md border-neutral-300"
              autocomplete="name"
              placeholder="Tu nombre"
            />

            <label
              class="mb-1 block text-primary font-bold"
              for={formFields.email}
              >Correo
            </label>
            <input
              type="email"
              id={formFields.email}
              name={formFields.email}
              class="w-full p-2 mb-6 border rounded-md border-neutral-300"
              autocomplete="email"
              placeholder="Tu correo"
            />

            <label
              class="mb-1 block text-primary font-bold"
              for={formFields.phoneNumber}
              >Teléfono
            </label>
            <input
              type="tel"
              id={formFields.phoneNumber}
              name={formFields.phoneNumber}
              class="w-full p-2 mb-6 border rounded-md border-neutral-300"
              autocomplete="tel"
              placeholder="Tu teléfono"
            />

            <label
              class="mb-1 block text-primary font-bold"
              for={formFields.company}
              >Empresa
            </label>
            <input
              type="text"
              id={formFields.company}
              name={formFields.company}
              class="w-full p-2 mb-6 border rounded-md border-neutral-300"
              autocomplete="organization"
              placeholder="Tu empresa"
            />

            <label
              class="mb-1 block text-primary font-bold"
              for={formFields.message}>Mensaje</label
            >
            <textarea
              id={formFields.message}
              name={formFields.message}
              rows="4"
              class="w-full p-2 mb-6 border rounded-md border-neutral-300 resize-none"
              placeholder="Escribe aquí tu mensaje"></textarea>

            <div class="flex justify-end">
              <input
                type="submit"
                value="Enviar"
                class="mb-8 md:mb-0 py-4 px-8 bold text-white cursor-pointer rounded-md bg-primary"
              />
            </div>
          </form>
        </div>
      </div>
    </section>
  </main>
</Layout>

<script>
  const form = document.querySelector("form");
  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const formData = new FormData(e.target as HTMLFormElement);
    const data = Object.fromEntries(formData);

    fetch("/api/send-email", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    }).then((res) =>
      res.ok
        ? console.log("Email enviado")
        : console.error("Error al enviar email"),
    );
    // .then((res) => console.log(res))  //ToDo: Mostrar mensaje de éxito
    // .catch((err) => console.error(err));
  });
</script>
